<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Trabalho de TG - Transportadora</title>

    <!-- Bootstrap CDN -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="public/styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/vis-network@9.0.2/dist/vis-network.min.js"></script>
    <script src="js-graphs.js"></script>
  </head>

  <body>
    <div class="container mt-4">
      <h1>Trabalho de TG - Transportadora</h1>
      <hr>
      <h2 id="fluxo-maximo">Aqui</h2>
      <h3>Mapa de transporte entre cidades de Minas Gerais</h3>
      <div id="mynetwork"></div>
        
        <script type="text/javascript">
            (function(){
                var g = new jsgraphs.FlowNetwork(8);
                g.addEdge(new jsgraphs.FlowEdge(0, 1, 30));
                g.addEdge(new jsgraphs.FlowEdge(0, 2, 50));
                g.addEdge(new jsgraphs.FlowEdge(2, 1, 10));
                g.addEdge(new jsgraphs.FlowEdge(1, 3, 120));
                g.addEdge(new jsgraphs.FlowEdge(2, 4, 150));
                g.addEdge(new jsgraphs.FlowEdge(3, 4, 70));
                g.addEdge(new jsgraphs.FlowEdge(4, 3, 70));
                // g.addEdge(new jsgraphs.FlowEdge(3, 6, 16));
                // g.addEdge(new jsgraphs.FlowEdge(4, 5, 15));
                // g.addEdge(new jsgraphs.FlowEdge(4, 7, 10));
                // g.addEdge(new jsgraphs.FlowEdge(5, 7, 10));
                // g.addEdge(new jsgraphs.FlowEdge(5, 6, 15));
                // g.addEdge(new jsgraphs.FlowEdge(6, 2, 6));
                // g.addEdge(new jsgraphs.FlowEdge(6, 7, 10)); 

                var source = 0;
                var target = 3;
                var ff = new jsgraphs.FordFulkerson(g, source, target);
                console.log('max-flow: ' + ff.value);
                let fluxoMaximo = ff.value;
                let texto = `O Fluxo Máximo de carga é ${fluxoMaximo}`;
                let elemento = document.getElementById('fluxo-maximo');
                elemento.textContent = texto;
                var minCut = ff.minCut(g);
                console.log('Printou?')

                var g_nodes = [];
                var g_edges = [];
                g.node(1).label = 'Belo Horizonte';
                for(var v=0; v < g.V; ++v){
                    if(v == 0){
                        g.node(v).label = 'Belo Horizonte ' + v; 
                    }
                    else if(v == 1){
                        g.node(v).label = 'Contagem ' + v; 
                    }
                    else if(v == 2){
                        g.node(v).label = 'Betim ' + v; 
                    }
                    else if(v == 3){
                        g.node(v).label = 'Uberlândia' + v; 
                    }
                    else if(v == 4){
                        g.node(v).label = 'Uberaba ' + v; 
                    }
                    //g.node(v).label = 'Cidade ' + v; // assigned 'Node {v}' as label for node v
                    if(v == source) g.node(v).label = 'Belo Horizonte ' + v;
                    if(v == target) g.node(v).label = 'Uberaba ' + v;
                    g_nodes.push({
                       id: v,
                       label: g.node(v).label,
                       group: (v == source || v == target ? 2 : 5) 
                    });
                }
                
                for(var i = 0; i < minCut.length; ++i) {
                    var e = minCut[i];
                    e.highlighted = true;
                    console.log('min-cut: (' + e.from() + ", " + e.to() + ')');
                    var v = e.from();
                    var w = e.to();
                    g_edges.push({
                        from: v,
                        to: w,
                        label: '' + e.flow + '/' + e.capacity,
                        arrows:'to',
                        color: '#ff0000'
                    });
                }

                
                for(var v = 0; v < g.V; ++v) {
                    var adj_v = g.adj(v);
                    for(var i = 0; i < adj_v.length; ++i) {
                        var e = adj_v[i];
                        var w = e.other(v);
                        if(w != e.to()) continue;
                        if(e.highlighted) continue;
                        g_edges.push({
                            from: v,
                            to: w,
                            label: '' + e.flow + '/' + e.capacity,
                            arrows:'to'
                        });
                    };
                }

                console.log(g.V); // display 6, which is the number of vertices in g
                console.log(g.adj(0)); // display [5, 1, 2], which is the adjacent list to vertex 0
                
                var nodes = new vis.DataSet(g_nodes);

                // create an array with edges
                var edges = new vis.DataSet(g_edges);

                // create a network
                var container = document.getElementById('mynetwork');
                var data = {
                    nodes: nodes,
                    edges: edges
                };
                var options = {};
                var network = new vis.Network(container, data, options);
            })();
        </script>
    </div>

    <!-- Biblioteca Vis.js -->
    <script type="text/javascript" src="https://visjs.github.io/vis-network/standalone/umd/vis-network.min.js"></script>

    <!-- Script para plotar o grafo -->
    <scrip type="text/javascript" src="script.js"></script>
    
  
  </body>
</html>